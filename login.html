<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Login | The Lalit Intl.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --royal-blue: #002366; --gold: #D4AF37; }
        body { background: linear-gradient(135deg, var(--royal-blue) 0%, #001a4d 100%); height: 100vh; display: flex; align-items: center; justify-content: center; font-family: sans-serif; }
        .login-card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 20px 50px rgba(0,0,0,0.4); width: 100%; max-width: 400px; text-align: center; }
        .form-control { margin-bottom: 20px; padding: 12px; border-radius: 8px; }
        .btn-login { background: var(--royal-blue); color: var(--gold); font-weight: bold; width: 100%; padding: 12px; border: 1px solid var(--gold); cursor: pointer; }
        #statusMsg { font-size: 0.85rem; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="login-card">
    <h3 class="fw-bold mb-4" style="color: var(--royal-blue);">STAFF PORTAL</h3>
    <input type="email" id="email" class="form-control" placeholder="Email Address">
    <input type="password" id="pass" class="form-control" placeholder="Password">
    <button class="btn btn-login" id="loginBtn">AUTHENTICATE SYSTEM</button>
    <div id="statusMsg"></div>
    <hr>
    <a href="index.html" class="text-decoration-none text-muted small"><i class="fas fa-arrow-left"></i> Back to School Website</a>
</div>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>

<script src="firebase-config.js"></script>

<script>
    // System Initialize Check
    let auth, db;
    try {
        auth = firebase.auth();
        db = firebase.firestore();
        console.log("Firebase System Online");
    } catch (e) {
        document.getElementById('statusMsg').innerHTML = "<span class='text-danger'>Firebase Config Missing!</span>";
    }

    // Login Function
    async function processLogin() {
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('pass').value;
        const msg = document.getElementById('statusMsg');
        const btn = document.getElementById('loginBtn');

        if(!email || !pass) {
            msg.innerHTML = "<span class='text-danger'>Fields cannot be empty!</span>";
            return;
        }

        btn.disabled = true;
        btn.innerText = "VERIFYING...";

        try {
            const userCredential = await auth.signInWithEmailAndPassword(email, pass);
            msg.innerHTML = "<span class='text-success'>Success! Redirecting...</span>";

            // Role Check
            const snap = await db.collection('users').where('email', '==', email.toLowerCase()).get();

            if (!snap.empty) {
                const role = snap.docs[0].data().role;
                if (role === 'admin') window.location.href = "dashboard.html";
                else if (role === 'accountant') window.location.href = "collect-fees.html";
                else if (role === 'teacher') window.location.href = "attendance.html";
                else window.location.href = "dashboard.html";
            } else {
                // Agar role nahi mila par user valid hai
                window.location.href = "dashboard.html";
            }
        } catch (error) {
            btn.disabled = false;
            btn.innerText = "AUTHENTICATE SYSTEM";
            msg.innerHTML = "<span class='text-danger'>" + error.message + "</span>";
            console.error(error);
        }
    }

    // Button Click Listener (Isse button dead nahi hoga)
    document.getElementById('loginBtn').addEventListener('click', processLogin);
</script>
</body>
</html>
