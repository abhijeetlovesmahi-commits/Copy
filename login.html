async function signIn() {
    const email = document.getElementById('email').value.trim().toLowerCase(); // Email ko saaf kiya
    const pass = document.getElementById('pass').value;
    const msg = document.getElementById('msg');
    const btn = document.getElementById('loginBtn');

    btn.disabled = true;
    btn.innerText = "CHECKING...";

    try {
        // Step 1: Firebase Auth login
        const userCredential = await auth.signInWithEmailAndPassword(email, pass);
        console.log("Auth Success:", userCredential.user.email);

        // Step 2: Firestore mein Role dhoondhna
        // Dhyaan de: 'users' collection mein 'email' field hona chahiye
        const snap = await db.collection('users').where('email', '==', email).get();

        if (!snap.empty) {
            const userData = snap.docs[0].data();
            const role = userData.role;
            console.log("User Role Found:", role);

            // Sahi page par bhejna
            if (role === 'admin') window.location.href = "dashboard.html";
            else if (role === 'accountant') window.location.href = "collect-fees.html";
            else if (role === 'teacher') window.location.href = "attendance.html";
            else {
                msg.innerText = "Role '" + role + "' not recognized.";
                auth.signOut();
            }
        } else {
            console.error("Firestore mein email nahi mila!");
            msg.innerText = "Auth OK, but Role not found in Database.";
            auth.signOut();
        }
    } catch (error) {
        console.error("Login Error:", error.code, error.message);
        msg.innerText = "Error: " + error.message;
        btn.disabled = false;
        btn.innerText = "AUTHENTICATE";
    }
}
