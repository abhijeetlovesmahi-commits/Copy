<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Login | The Lalit Intl.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --royal-blue: #002366; --gold: #D4AF37; }
        body { background: #001a4d; height: 100vh; display: flex; align-items: center; justify-content: center; font-family: sans-serif; }
        .login-card { background: white; padding: 40px; border-radius: 12px; width: 100%; max-width: 380px; text-align: center; border-top: 5px solid var(--gold); }
        .form-control { margin-bottom: 15px; border-radius: 5px; }
        .btn-login { background: var(--royal-blue); color: var(--gold); font-weight: bold; width: 100%; padding: 12px; border: none; cursor: pointer; }
        #statusMsg { font-size: 0.8rem; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="login-card">
    <h4 class="fw-bold mb-4" style="color: var(--royal-blue);">STAFF LOGIN</h4>
    <input type="email" id="email" class="form-control" placeholder="Email Address">
    <input type="password" id="pass" class="form-control" placeholder="Password">
    <button class="btn btn-login" id="loginBtn">AUTHENTICATE</button>
    <div id="statusMsg"></div>
    <hr>
    <a href="index.html" class="text-muted small text-decoration-none">Back to Website</a>
</div>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>

<script src="firebase-config.js"></script>

<script>
    // System Initialize Check
    let auth, db;
    try {
        // Ise initialize karne ki koshish karein
        auth = firebase.auth();
        db = firebase.firestore();
        console.log("Firebase initialized successfully");
    } catch (e) {
        console.error("Firebase init error:", e);
        document.getElementById('statusMsg').innerHTML = "<span class='text-danger'>Config File Error! Check firebase-config.js</span>";
    }

    // Login Function
    async function processLogin() {
        const email = document.getElementById('email').value.trim();
        const pass = document.getElementById('pass').value;
        const msg = document.getElementById('statusMsg');
        const btn = document.getElementById('loginBtn');

        if(!email || !pass) {
            msg.innerHTML = "<span class='text-danger'>Fields cannot be empty!</span>";
            return;
        }

        btn.disabled = true;
        btn.innerText = "VERIFYING...";

        try {
            // Auth check
            await auth.signInWithEmailAndPassword(email, pass);
            msg.innerHTML = "<span class='text-success'>Access Granted! Redirecting...</span>";

            // Firestore Role Check
            const snap = await db.collection('users').where('email', '==', email.toLowerCase()).get();

            if (!snap.empty) {
                const role = snap.docs[0].data().role;
                // Sahi page par bhejein
                if (role === 'admin') window.location.href = "dashboard.html";
                else if (role === 'accountant') window.location.href = "collect-fees.html";
                else if (role === 'teacher') window.location.href = "attendance.html";
                else window.location.href = "dashboard.html";
            } else {
                // Agar role nahi mila par user valid hai
                window.location.href = "dashboard.html";
            }
        } catch (error) {
            btn.disabled = false;
            btn.innerText = "AUTHENTICATE";
            msg.innerHTML = "<span class='text-danger'>" + error.message + "</span>";
            console.error("Login Error:", error);
        }
    }

    // Button par click listener lagayein
    document.getElementById('loginBtn').addEventListener('click', processLogin);
</script>
</body>
</html>
