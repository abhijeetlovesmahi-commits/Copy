<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Student - The Lalit International</title>
    <style>
        :root { --royal-blue: #002366; --gold: #D4AF37; --light-gold: #FDFBF0; --white: #ffffff; }
        body { background: var(--light-gold); margin: 0; padding: 20px; font-family: 'Georgia', serif; color: var(--royal-blue); }
        .container { max-width: 800px; margin: 0 auto; background: var(--white); padding: 30px; border: 1px solid var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 3px double var(--gold); margin-bottom: 30px; padding-bottom: 10px; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .full-width { grid-column: span 2; }
        
        label { font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 5px; color: #555; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-bottom: 2px solid var(--gold); outline: none; box-sizing: border-box; }
        input[readonly] { background: #eee; cursor: not-allowed; border-bottom: 2px solid #999; }
        
        .btn-group { margin-top: 30px; display: flex; gap: 15px; }
        .btn-save { background: var(--royal-blue); color: var(--gold); flex: 2; padding: 15px; border: 1px solid var(--gold); cursor: pointer; font-weight: bold; text-transform: uppercase; }
        .btn-delete { background: #e74c3c; color: white; flex: 1; padding: 15px; border: none; cursor: pointer; font-weight: bold; }
        .btn-back { display: inline-block; margin-bottom: 20px; color: var(--royal-blue); text-decoration: none; font-weight: bold; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
</head>
<body>

<div class="container">
    <a href="management.html" class="btn-back">‚Üê Back to Management</a>
    <div class="header">
        <h1>Update Student Profile</h1>
        <p>THE LALIT INTERNATIONAL SCHOOL</p>
    </div>

    <form id="updateForm">
        <div class="form-grid">
            <div class="full-width">
                <label>Student Full Name</label>
                <input type="text" id="uName" required>
            </div>
            <div>
                <label>Unique ID (Permanent)</label>
                <input type="text" id="uID" readonly>
            </div>
            <div>
                <label>Roll Number</label>
                <input type="text" id="uRoll">
            </div>
            <div>
                <label>Class</label>
                <select id="uClass">
                    <option value="Pre-Nursery">Pre-Nursery</option>
                    <option value="Nursery">Nursery</option>
                    <option value="LKG">LKG</option>
                    <option value="UKG">UKG</option>
                    <script>for(let i=1; i<=12; i++) document.write(`<option value="${i}">${i}</option>`);</script>
                </select>
            </div>
            <div>
                <label>Section</label>
                <select id="uSec">
                    <option value="A">A</option><option value="B">B</option><option value="C">C</option>
                </select>
            </div>
            <div>
                <label>Father's Name</label>
                <input type="text" id="uFather">
            </div>
            <div>
                <label>Contact Number</label>
                <input type="tel" id="uPhone">
            </div>
        </div>

        <div class="btn-group">
            <button type="button" class="btn-save" onclick="updateStudent()">Save All Changes</button>
            <button type="button" class="btn-delete" onclick="deleteStudent()">Delete Record</button>
        </div>
    </form>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
  authDomain: "the-lalit-d7472.firebaseapp.com",
  projectId: "the-lalit-d7472",
  appId: "1:479237084229:web:31078825739b3c5712ff2c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// URL se Document ID nikalna (id=FIREBASE_DOC_ID)
const urlParams = new URLSearchParams(window.location.search);
const docId = urlParams.get('id');

if(docId) {
    db.collection('students').doc(docId).get().then(doc => {
        if(doc.exists) {
            const s = doc.data();
            document.getElementById('uName').value = s.name || '';
            document.getElementById('uID').value = s.uniqueID || '';
            document.getElementById('uRoll').value = s.rollNo || '';
            document.getElementById('uClass').value = s.class || '';
            document.getElementById('uSec').value = s.section || 'A';
            document.getElementById('uFather').value = s.father || '';
            document.getElementById('uPhone').value = s.contact || '';
        } else {
            alert("No student found!");
        }
    });
}

async function updateStudent() {
    try {
        await db.collection('students').doc(docId).update({
            name: document.getElementById('uName').value,
            rollNo: document.getElementById('uRoll').value,
            class: document.getElementById('uClass').value,
            section: document.getElementById('uSec').value,
            father: document.getElementById('uFather').value,
            contact: document.getElementById('uPhone').value,
            lastUpdated: new Date()
        });
        alert("Profile Updated Successfully!");
        window.location.href = "management.html";
    } catch (err) {
        alert("Update Failed: " + err.message);
    }
}

async function deleteStudent() {
    if(confirm("KYA AAP PAKKA DELETE KARNA CHAHTE HAIN? Ye record wapas nahi aayega!")) {
        try {
            await db.collection('students').doc(docId).delete();
            alert("Student Record Erased.");
            window.location.href = "management.html";
        } catch (err) {
            alert("Delete Failed: " + err.message);
        }
    }
}
</script>
<script src="menu.js"></script>
</body>
</html>
