<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Master Reset</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; display: flex; align-items: center; justify-content: center; height: 100vh; }
        .reset-card { max-width: 500px; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white; text-align: center; }
        .warning-icon { font-size: 50px; color: #dc3545; margin-bottom: 15px; }
        #status { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="reset-card">
    <div class="warning-icon">⚠️</div>
    <h3>Database Master Reset</h3>
    <p class="text-muted">Yeh action aapke Firebase Firestore se niche diye gaye saare collections ko **Puri Tarah Delete** kar dega:</p>
    <ul class="text-start mb-4">
        <li>Students Data</li>
        <li>Fee Transactions (Payments)</li>
        <li>Fee Master (Class Wise Fees)</li>
        <li>Transport Master</li>
    </ul>
    
    <div class="alert alert-danger">
        <strong>Warning:</strong> Yeh wapas nahi laya ja sakta (Irreversible).
    </div>

    <button id="resetBtn" class="btn btn-danger btn-lg w-100" onclick="confirmReset()">
        CLEAR ALL DATA NOW
    </button>
    
    <div id="status"></div>
    <a href="index.html" class="btn btn-link mt-3">Back to Dashboard</a>
</div>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
    async function deleteCollection(collectionName) {
        const snapshot = await db.collection(collectionName).get();
        if (snapshot.empty) return 0;

        const batch = db.batch();
        snapshot.docs.forEach((doc) => {
            batch.delete(doc.ref);
        });
        await batch.commit();
        return snapshot.size;
    }

    async function confirmReset() {
        const pin = prompt("Safety Check: Type 'DELETE' to confirm clearing all data:");
        
        if (pin === "DELETE") {
            const btn = document.getElementById('resetBtn');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            btn.innerText = "Processing Reset...";
            status.innerHTML = "Cleaning database, please wait...";

            try {
                // List of all collections to clear
                const collections = ['students', 'fee_transactions', 'fee_master', 'transport_master'];
                let totalDeleted = 0;

                for (let col of collections) {
                    totalDeleted += await deleteCollection(col);
                }

                status.className = "text-success mt-3";
                status.innerHTML = `✅ Success! All data cleared. Total documents removed: ${totalDeleted}`;
                btn.innerText = "DATABASE CLEARED";
                
                alert("Database reset successful! Ab aap naya data entry shuru kar sakte hain.");
            } catch (error) {
                console.error("Error resetting database: ", error);
                status.className = "text-danger mt-3";
                status.innerHTML = "❌ Error: Reset fail ho gaya. Console check karein.";
                btn.disabled = false;
                btn.innerText = "RETRY RESET";
            }
        } else {
            alert("Reset Cancelled. Sahi spelling 'DELETE' type karein.");
        }
    }
</script>

</body>
</html>
