<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Website Manager | Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        .manager-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .gallery-upload-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
        .upload-box { background: rgba(255,255,255,0.1); padding: 10px; border: 1px dashed var(--gold); border-radius: 8px; }
        .upload-box input[type="text"] { font-size: 10px; margin-bottom: 5px; background: #fff; color: #000; }
        .upload-box input[type="file"] { font-size: 10px; color: var(--gold); }
        .status-text { font-size: 9px; display: block; margin-top: 2px; }
        .preview-mini { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; float: right; display: none; border: 1px solid var(--gold); }
    </style>
</head>
<body>

    <main class="main-content">
        <div class="royal-card">
            <header class="header">
                <h1 class="brand-font">Master Website Manager</h1>
                <p style="color:var(--gold)">Live Content & Image Server Control</p>
            </header>

            <div class="manager-grid">
                
                <div class="form-section">
                    <h3><i class="fas fa-bullhorn"></i> News Ticker</h3>
                    <textarea id="newsTicker" placeholder="Marquee news likhein..."></textarea>
                    <button class="royal-btn" style="width:100%" onclick="saveSimpleData('content', 'newsData', 'newsTicker')">Update News</button>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-user-tie"></i> Director Message</h3>
                    <textarea id="dirMsg" placeholder="Message..."></textarea>
                    <div class="upload-box">
                        <img id="prev_dir" class="preview-mini">
                        <input type="text" id="dirUrl" placeholder="Image URL">
                        <input type="file" onchange="autoUpload(this, 'st_dir', 'dirUrl', 'prev_dir')">
                        <span id="st_dir" class="status-text"></span>
                    </div>
                    <button class="royal-btn" style="width:100%; margin-top:10px;" onclick="saveComplexData('messages', 'director', 'dirMsg', 'dirUrl')">Save Director</button>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-user-graduate"></i> Principal Message</h3>
                    <textarea id="priMsg" placeholder="Message..."></textarea>
                    <div class="upload-box">
                        <img id="prev_pri" class="preview-mini">
                        <input type="text" id="priUrl" placeholder="Image URL">
                        <input type="file" onchange="autoUpload(this, 'st_pri', 'priUrl', 'prev_pri')">
                        <span id="st_pri" class="status-text"></span>
                    </div>
                    <button class="royal-btn" style="width:100%; margin-top:10px;" onclick="saveComplexData('messages', 'principal', 'priMsg', 'priUrl')">Save Principal</button>
                </div>

                <div class="form-section" style="grid-column: span 1;">
                    <h3><i class="fas fa-images"></i> School Gallery (12 Photos)</h3>
                    <div class="gallery-upload-grid" id="galleryInputs">
                        </div>
                    <button class="royal-btn" style="width:100%; margin-top:15px;" onclick="saveGallery()">Update All 12 Photos</button>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-map-marker-alt"></i> Contact & Google Map</h3>
                    <input type="text" id="schoolPhone" placeholder="Phone Number">
                    <textarea id="schoolAddr" placeholder="Full Address..."></textarea>
                    <input type="text" id="mapEmbed" placeholder="Paste Iframe or Map Link here">
                    <button class="royal-btn" style="width:100%" onclick="saveContact()">Update Contact & Map</button>
                </div>

            </div>
        </div>
    </main>

    <script src="firebase-config.js"></script>
    <script>
        const IMGBB_API_KEY = '84054e1c5e021a85ff2e90390a9c43c9';

        // 12 Gallery Boxes banana
        const galleryGrid = document.getElementById('galleryInputs');
        for(let i=1; i<=12; i++) {
            galleryGrid.innerHTML += `
                <div class="upload-box">
                    <img id="prev_g${i}" class="preview-mini">
                    <input type="text" id="g${i}" placeholder="Photo ${i} URL">
                    <input type="file" onchange="autoUpload(this, 'st_g${i}', 'g${i}', 'prev_g${i}')">
                    <span id="st_g${i}" class="status-text"></span>
                </div>
            `;
        }

        // AUTO UPLOAD LOGIC
        async function autoUpload(fileInput, statusId, urlInputId, previewId) {
            const file = fileInput.files[0];
            const status = document.getElementById(statusId);
            const urlInput = document.getElementById(urlInputId);
            const preview = document.getElementById(previewId);

            if(!file) return;
            if(file.size > 10 * 1024 * 1024) { alert("File is too big! Max 10MB"); return; }

            status.innerText = "⏳ Uploading...";
            status.style.color = "gold";

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST', body: formData
                });
                const data = await response.json();
                if(data.success) {
                    urlInput.value = data.data.url;
                    status.innerText = "✅ Done!";
                    status.style.color = "#2ecc71";
                    preview.src = data.data.url;
                    preview.style.display = "block";
                } else { status.innerText = "❌ Failed"; }
            } catch(e) { status.innerText = "❌ Error"; }
        }

        // SAVE FUNCTIONS
        async function saveSimpleData(col, doc, id) {
            const val = document.getElementById(id).value;
            await firebase.firestore().collection(col).doc(doc).set({ text: val, lastUpdated: new Date() }, { merge: true });
            alert("Updated!");
        }

        async function saveComplexData(col, doc, msgId, urlId) {
            const msg = document.getElementById(msgId).value;
            const url = document.getElementById(urlId).value;
            await firebase.firestore().collection(col).doc(doc).set({ text: msg, imageUrl: url, lastUpdated: new Date() }, { merge: true });
            alert("Success!");
        }

        async function saveGallery() {
            let images = [];
            for(let i=1; i<=12; i++) {
                let val = document.getElementById(`g${i}`).value;
                if(val) images.push(val);
            }
            await firebase.firestore().collection('content').doc('gallery').set({ images: images });
            alert("Gallery Updated!");
        }

        async function saveContact() {
            let map = document.getElementById('mapEmbed').value;
            if(map.includes('<iframe')) {
                const match = map.match(/src="([^"]+)"/);
                map = match ? match[1] : map;
            }
            const phone = document.getElementById('schoolPhone').value;
            const addr = document.getElementById('schoolAddr').value;
            await firebase.firestore().collection('content').doc('contactInfo').set({
                phone: phone, address: addr, mapUrl: map
            }, { merge: true });
            alert("Contact & Map Updated!");
        }
    </script>
</body>
</html>
