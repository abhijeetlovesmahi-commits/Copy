<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit - Student Master List</title>
    <style>
        :root {
            --royal-blue: #002366;
            --gold: #D4AF37;
            --light-gold: #FDFBF0;
            --white: #ffffff;
        }

        body {
            background: var(--light-gold);
            margin: 0;
            padding: 20px;
            font-family: 'Georgia', serif;
            color: var(--royal-blue);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--white);
            padding: 30px;
            border: 1px solid var(--gold);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            border-bottom: 3px double var(--gold);
            margin-bottom: 25px;
            padding-bottom: 10px;
        }

        .school-logo { width: 90px; }

        /* Filter & Search Bar */
        .top-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #f9f9f9;
            padding: 15px;
            border: 1px solid #eee;
            flex-wrap: wrap;
        }

        input, select, .btn {
            padding: 10px;
            border: 1px solid var(--gold);
            font-family: 'Georgia', serif;
        }

        .search-input { flex: 2; min-width: 200px; }
        .btn-blue { background: var(--royal-blue); color: var(--gold); cursor: pointer; font-weight: bold; }
        .btn-gold { background: var(--gold); color: white; cursor: pointer; font-weight: bold; }

        /* Table Style */
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--royal-blue); color: var(--gold); padding: 12px; text-align: left; font-size: 0.85rem; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 0.9rem; vertical-align: middle; }

        .st-photo { width: 45px; height: 55px; object-fit: cover; border: 1px solid var(--gold); cursor: pointer; }
        .st-name { color: var(--royal-blue); font-weight: bold; cursor: pointer; text-decoration: none; }
        .st-name:hover { color: var(--gold); }

        .action-btns { display: flex; gap: 10px; }
        .edit-link { color: #28a745; text-decoration: none; font-weight: bold; border: 1px solid #28a745; padding: 4px 8px; font-size: 0.75rem; }
        .del-btn { color: #dc3545; cursor: pointer; font-weight: bold; border: 1px solid #dc3545; padding: 4px 8px; font-size: 0.75rem; }

        /* Profile Modal (Quick View) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 25px; width: 90%; max-width: 500px; border: 3px solid var(--gold); position: relative; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="logo.png" alt="Logo" class="school-logo">
        <h2>STUDENT DATABASE MASTER LIST</h2>
    </div>

    <div class="top-bar">
        <input type="text" id="masterSearch" class="search-input" placeholder="Search by Name, ID or Phone...">
        <select id="fClass">
            <option value="">All Classes</option>
            <option value="Pre-Nursery">Pre-Nursery</option>
            <option value="Nursery">Nursery</option>
            <option value="LKG">LKG</option><option value="UKG">UKG</option>
            <option value="1">Class 1</option><option value="2">Class 2</option>
            <option value="3">Class 3</option><option value="4">Class 4</option>
            <option value="5">Class 5</option><option value="6">Class 6</option>
            <option value="7">Class 7</option><option value="8">Class 8</option>
            <option value="9">Class 9</option><option value="10">Class 10</option>
            <option value="11">Class 11</option><option value="12">Class 12</option>
        </select>
        <select id="fSection">
            <option value="A">Sec A</option><option value="B">Sec B</option>
            <option value="C">Sec C</option><option value="D">Sec D</option>
        </select>
        <button class="btn-blue" onclick="loadFiltered()">GET LIST</button>
        <button class="btn-gold" onclick="loadAll()">VIEW ALL</button>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Photo</th>
                    <th>Roll</th>
                    <th>Full Name</th>
                    <th>Class</th>
                    <th>Sec</th>
                    <th>Manage</th>
                </tr>
            </thead>
            <tbody id="listBody">
                </tbody>
        </table>
    </div>
</div>

<div id="pModal" class="modal">
    <div class="modal-content" id="pContent"></div>
</div>

<script>
// --- YOUR FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
  authDomain: "the-lalit-d7472.firebaseapp.com",
  projectId: "the-lalit-d7472",
  appId: "1:479237084229:web:31078825739b3c5712ff2c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// 1. Load All
async function loadAll() {
    const snap = await db.collection('students').orderBy('timestamp', 'desc').get();
    render(snap);
}

// 2. Load Filtered
async function loadFiltered() {
    const cls = document.getElementById('fClass').value;
    const sec = document.getElementById('fSection').value;
    if(!cls) return alert("Select Class");
    const snap = await db.collection('students').where("classSection", "==", cls+sec).get();
    render(snap);
}

// 3. Render Table
function render(snap) {
    const tbody = document.getElementById('listBody');
    tbody.innerHTML = "";
    snap.forEach(doc => {
        const d = doc.data();
        tbody.innerHTML += `
            <tr>
                <td><img src="${d.photo}" class="st-photo" onclick="viewProfile('${doc.id}')"></td>
                <td>${d.rollNo || 'N/A'}</td>
                <td><a class="st-name" onclick="viewProfile('${doc.id}')">${d.name}</a></td>
                <td>${d.class}</td>
                <td>${d.section}</td>
                <td class="action-btns">
                    <a href="add-student.html?editID=${doc.id}" class="edit-link">FULL EDIT</a>
                    <span class="del-btn" onclick="deleteSt('${doc.id}')">DELETE</span>
                </td>
            </tr>`;
    });
}

// 4. View Profile Modal
async function viewProfile(id) {
    const doc = await db.collection('students').doc(id).get();
    const d = doc.data();
    document.getElementById('pContent').innerHTML = `
        <h3 style="text-align:center; border-bottom:2px solid var(--gold)">Student Details</h3>
        <center><img src="${d.photo}" style="width:120px; border:2px solid var(--gold); margin-bottom:10px;"></center>
        <p><b>Name:</b> ${d.name} | <b>ID:</b> ${d.uniqueID}</p>
        <p><b>Father:</b> ${d.father} | <b>Contact:</b> ${d.contact}</p>
        <p><b>Aadhar:</b> ${d.aadhar} | <b>DOB:</b> ${d.dob}</p>
        <p><b>Address:</b> ${d.currentAddr}</p>
        <button class="btn-blue" style="width:100%" onclick="document.getElementById('pModal').style.display='none'">CLOSE</button>
    `;
    document.getElementById('pModal').style.display = 'flex';
}

// 5. Delete
async function deleteSt(id) {
    if(confirm("Permanently delete?")) {
        await db.collection('students').doc(id).delete();
        loadAll();
    }
}

// 6. Search
document.getElementById('masterSearch').addEventListener('input', async (e) => {
    const term = e.target.value.toLowerCase();
    const snap = await db.collection('students').get();
    const tbody = document.getElementById('listBody');
    tbody.innerHTML = "";
    snap.forEach(doc => {
        const d = doc.data();
        if(d.name.toLowerCase().includes(term) || d.contact.includes(term) || d.uniqueID.toString().includes(term)) {
            renderSearchRow(doc.id, d);
        }
    });
});

function renderSearchRow(id, d) {
    document.getElementById('listBody').innerHTML += `
        <tr>
            <td><img src="${d.photo}" class="st-photo" onclick="viewProfile('${id}')"></td>
            <td>${d.rollNo || 'N/A'}</td>
            <td><a class="st-name" onclick="viewProfile('${id}')">${d.name}</a></td>
            <td>${d.class}</td>
            <td>${d.section}</td>
            <td class="action-btns">
                <a href="add-student.html?editID=${id}" class="edit-link">FULL EDIT</a>
                <span class="del-btn" onclick="deleteSt('${id}')">DELETE</span>
            </td>
        </tr>`;
}

loadAll();
</script>
</body>
</html>
