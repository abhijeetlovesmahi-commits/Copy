<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Students - Admin Panel</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .filter-section { 
            display: flex; 
            gap: 15px; 
            background: #fff; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            border: 1px solid #ddd;
            align-items: flex-end;
        }
        
        .filter-group { display: flex; flex-direction: column; flex: 1; }
        label { font-weight: bold; margin-bottom: 5px; color: #555; }
        select { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
        
        .btn-view { padding: 10px 25px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; height: 42px; font-weight: bold; }
        .btn-view:hover { background: #0056b3; }

        .student-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        
        /* Student Card Design */
        .profile-card { 
            background: #fff; 
            border-radius: 15px; 
            overflow: hidden; 
            border: 1px solid #eee; 
            transition: transform 0.2s; 
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .profile-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .card-header { background: #007bff; color: white; padding: 15px; text-align: center; }
        .card-header h3 { margin: 0; font-size: 18px; text-transform: uppercase; }
        .card-body { padding: 15px; font-size: 14px; line-height: 1.6; }
        .card-body p { margin: 5px 0; border-bottom: 1px solid #f9f9f9; }
        .card-body b { color: #333; width: 100px; display: inline-block; }

        .no-data { text-align: center; padding: 50px; color: #888; grid-column: 1 / -1; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; color: #333;">Class-wise Student Records</h2>
    <hr><br>

    <div class="filter-section">
        <div class="filter-group">
            <label>Select Class</label>
            <select id="filterClass">
                <option value="">-- Choose Class --</option>
                <option value="Pre-Nursery">Pre-Nursery</option>
                <option value="Nursery">Nursery</option>
                <option value="1">1st</option>
                <option value="2">2nd</option>
                <option value="3">3rd</option>
                <option value="10">10th</option>
                <option value="12">12th</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Select Section</label>
            <select id="filterSection">
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
            </select>
        </div>
        <button class="btn-view" onclick="fetchStudents()">View List</button>
    </div>

    <div id="studentList" class="student-list">
        <div class="no-data">Please select Class and Section to view students.</div>
    </div>
</div>

<script>
// --- Firebase Configuration ---
const firebaseConfig = {
  apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
  authDomain: "the-lalit-d7472.firebaseapp.com",
  databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com",
  projectId: "the-lalit-d7472",
  storageBucket: "the-lalit-d7472.firebasestorage.app",
  messagingSenderId: "479237084229",
  appId: "1:479237084229:web:31078825739b3c5712ff2c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Fetch Students Logic ---
function fetchStudents() {
    const sClass = document.getElementById('filterClass').value;
    const sSection = document.getElementById('filterSection').value;
    const listDiv = document.getElementById('studentList');

    if(!sClass) {
        alert("Please select a class first!");
        return;
    }

    listDiv.innerHTML = "<div class='no-data'>Loading students...</div>";

    // Query database where classSection matches (e.g., "10A")
    const queryValue = sClass + sSection;
    
    db.ref('students').orderByChild('classSection').equalTo(queryValue).once('value', (snapshot) => {
        listDiv.innerHTML = "";
        
        if(!snapshot.exists()) {
            listDiv.innerHTML = "<div class='no-data'>No students found in this class/section.</div>";
            return;
        }

        snapshot.forEach((child) => {
            const data = child.val();
            listDiv.innerHTML += `
                <div class="profile-card" onclick="openFullProfile('${data.uniqueID}')">
                    <div class="card-header">
                        <h3>${data.name}</h3>
                        <span>Roll No: ${data.rollNo}</span>
                    </div>
                    <div class="card-body">
                        <p><b>Unique ID:</b> ${data.uniqueID}</p>
                        <p><b>Father:</b> ${data.father}</p>
                        <p><b>Contact:</b> ${data.contact}</p>
                        <p><b>House:</b> ${data.house}</p>
                    </div>
                </div>
            `;
        });
    });
}

// --- Function to go to detailed profile ---
function openFullProfile(id) {
    // Aap yahan se profile view page par bhej sakte hain
    // Ya phir usi addstudent.html wale modal logic ko yahan bhi use kar sakte hain
    alert("Full details for ID: " + id + "\n(Yahan aap student ka detailed page open kar sakte hain)");
}

</script>
</body>
</html>
