<script>
function renderSlips(list, month) {
    let html = '';
    list.forEach(s => {
        const fm = feeMaster[s.class] || {};
        const d = s.discounts || {};

        // 1. Monthly Components (Tuition, Hostel, Transport)
        const tui = (fm.tuition || 0) * (1 - (d.tuition || 0)/100);
        const hos = (s.hostel === 'Yes' ? (fm.hostel || 0) : 0) * (1 - (d.hostel || 0)/100);
        const tra = (s.transport === 'Yes' ? (transMaster[s.transportDistance] || 0) : 0) * (1 - (d.trans || 0)/100);

        let annualTotal = 0;
        let annualRows = '';

        // 2. Annual Charges Sync (Exactly matching Ledger Grid)
        if (month === 'April') {
            const adm = (fm.admission || 0) * (1 - (d.adm || 0)/100);
            const dev = (fm.development || 0) * (1 - (d.dev || 0)/100);
            const exa = (fm.exam || 0) * (1 - (d.exam || 0)/100);
            const boo = (fm.books || 0) * (1 - (d.books || 0)/100);
            const mis = (fm.misc || 0) * (1 - (d.misc || 0)/100);
            
            // Ledger ki "Registration & Annual Fee" row ka sum
            annualTotal = Math.round(adm + dev + exa + boo + mis);
            
            if(annualTotal > 0) {
                annualRows = `<tr><td>Registration & Annual Fee</td><td class="text-end">₹${annualTotal}</td></tr>`;
            }
        }

        const netPayable = Math.round(tui + hos + tra + annualTotal);

        html += `
        <div class="slip-card">
            <div class="row mb-3 px-2">
                <div class="col-4">ID: <b>${s.uniqueID}</b></div>
                <div class="col-4 text-center">NAME: <b>${s.name}</b></div>
                <div class="col-4 text-end">CLASS: <b>${s.class}</b></div>
            </div>

            <table class="fee-table">
                <thead><tr><th>PARTICULARS</th><th class="text-end">AMOUNT</th></tr></thead>
                <tbody>
                    <tr><td>Monthly Tuition Fee</td><td class="text-end">₹${Math.round(tui)}</td></tr>
                    ${tra > 0 ? `<tr><td>Transport Fee (${s.transportDistance})</td><td class="text-end">₹${Math.round(tra)}</td></tr>` : ''}
                    ${hos > 0 ? `<tr><td>Hostel Fee</td><td class="text-end">₹${Math.round(hos)}</td></tr>` : ''}
                    ${annualRows}
                </tbody>
                <tfoot>
                    <tr class="total-row"><td class="text-end">NET PAYABLE AMOUNT:</td><td class="text-end">₹${netPayable}</td></tr>
                </tfoot>
            </table>
            </div>`;
    });
    document.getElementById('printArea').innerHTML = html;
}
</script>
