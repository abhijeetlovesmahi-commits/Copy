// --- 1. MASTER PAGE LIST (GENUINE ACCESS) ---
const masterPages = {
    "Admission & Registry": {
        view_students: "Student Registry",
        add_student: "New Admission",
        edit_student: "Edit Student Data"
    },
    "Academic & Exams": {
        attendance: "Daily Attendance",
        exam_master: "Exam Master Setup",
        marks_entry: "Exam Marks Entry",
        report_card: "Report Card Print"
    },
    "Treasury & Accounts": {
        fee_master: "Fee Structure Setup",
        collect_fees: "Collect Student Fees",
        fee_history: "Daily Fee History",
        demand_slip: "Demand Slip Generator",
        master_ledger: "School Master Ledger",
        defaulter_list: "Fee Defaulter List"
    },
    "Administration": {
        manage_users: "Staff & Role Manager",
        web_control: "Website Manager"
    }
};

// --- 2. COMMON HTML GENERATOR ---
// Ye function naya user banate waqt aur edit karte waqt same list dikhayega
function generatePermList(containerId, currentPerms = {}, isEdit = false) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    const prefix = isEdit ? "edit_" : "new_";

    for (const [category, pages] of Object.entries(masterPages)) {
        let html = `<span class="section-title text-primary fw-bold small mt-3 d-block">${category}</span>`;
        for (const [id, label] of Object.entries(pages)) {
            const isChecked = currentPerms[id] ? "checked" : "";
            html += `
                <div class="form-check form-switch mb-1">
                    <input class="form-check-input perm-switch" type="checkbox" id="${prefix}${id}" ${isChecked} data-key="${id}">
                    <label class="form-check-label small" for="${prefix}${id}">${label}</label>
                </div>`;
        }
        container.insertAdjacentHTML('beforeend', html);
    }
}

// --- 3. SAVE LOGIC (FOR BOTH) ---
function getSelectedPerms(selector) {
    let perms = {};
    document.querySelectorAll(selector).forEach(checkbox => {
        const key = checkbox.getAttribute('data-key');
        perms[key] = checkbox.checked;
    });
    return perms;
}

// --- 4. USAGE ---
// Window Load par naye user ke liye list generate karein
window.onload = () => {
    generatePermList("new_staff_perms_container"); 
    loadStaffTable(); // Aapka table load karne wala function
};

// Edit button click par
async function openEditModal(uid, name) {
    const doc = await db.collection('users').doc(uid).get();
    const currentPerms = doc.data().permissions || {};
    generatePermList("edit_staff_perms_container", currentPerms, true);
    // Modal show karne ka code...
}
