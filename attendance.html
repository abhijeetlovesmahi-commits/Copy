<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperial Attendance - TLIS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="sidebar">
    <div class="logo-box">
        <img src="logo.png" class="school-logo">
        <h5 class="mt-3">The Lalit Intl.</h5>
    </div>
    <div class="nav-links">
        <a href="index.html"><i class="fas fa-crown me-2"></i> Dashboard</a>
        <a href="add-student.html"><i class="fas fa-scroll me-2"></i> New Admission</a>
        <a href="view-students.html"><i class="fas fa-users me-2"></i> Student List</a>
        <a href="attendance.html" class="active"><i class="fas fa-pen-fancy me-2"></i> Attendance</a>
        <a href="fees.html"><i class="fas fa-coins me-2"></i> Fee Collection</a>
        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Logout</a>
    </div>
</div>

<div class="main-content">
    <div class="royal-card">
        <h3 class="mb-4">Daily Imperial Roll Call</h3>
        <select id="classSelect" class="form-select mb-4" onchange="loadStudents()">
            <option value="">-- Select Class --</option>
            <option value="1">Class 1</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
        </select>
        <table class="table align-middle">
            <thead><tr><th>Roll</th><th>Student Name</th><th>Action</th></tr></thead>
            <tbody id="attendanceBody"></tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs", authDomain: "the-lalit-d7472.firebaseapp.com", databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com", projectId: "the-lalit-d7472", storageBucket: "the-lalit-d7472.firebasestorage.app", messagingSenderId: "479237084229", appId: "1:479237084229:web:f1da384b45c5883b12ff2c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const today = new Date().toLocaleDateString('en-GB').replace(/\//g, "-");

    firebase.auth().onAuthStateChanged(u => { if(!u) window.location.href="login.html"; });

    function loadStudents() {
        const cls = document.getElementById('classSelect').value;
        const body = document.getElementById('attendanceBody');
        body.innerHTML = "";
        db.ref('students').once('value', snap => {
            snap.forEach(child => {
                const s = child.val();
                if(s.class == cls) {
                    body.innerHTML += `<tr><td>${s.roll}</td><td>${s.name}</td><td>
                        <button class="royal-btn btn-sm" onclick="mark('${s.roll}','Present',this)">Present</button>
                        <button class="btn btn-outline-danger btn-sm ms-2" onclick="mark('${s.roll}','Absent',this)">Absent</button>
                    </td></tr>`;
                }
            });
        });
    }

    function mark(roll, status, btn) {
        db.ref('attendance/'+today+'/'+roll).set({status: status}).then(() => {
            btn.innerText = "Marked " + status;
            btn.classList.add('opacity-50');
        });
    }

    function logout() { firebase.auth().signOut().then(() => { window.location.href = "login.html"; }); }
</script>
</body>
</html>
