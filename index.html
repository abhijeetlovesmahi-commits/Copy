<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperial Dashboard - TLIS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --velvet: #300a24; --gold: #d4af37; --parchment: #f4e4bc; }
        body { background: var(--velvet); font-family: 'Georgia', serif; color: var(--gold); display: flex; min-height: 100vh; margin: 0; }
        
        /* Royal Sidebar */
        .sidebar { width: 260px; background: rgba(0,0,0,0.4); border-right: 2px solid var(--gold); height: 100vh; position: fixed; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }
        .logo-box { padding: 30px 15px; text-align: center; border-bottom: 1px solid var(--gold); }
        .school-logo { width: 90px; height: 90px; border-radius: 50%; border: 3px double var(--gold); box-shadow: 0 0 10px var(--gold); }
        .sidebar a { color: var(--gold); text-decoration: none; padding: 15px 25px; display: block; font-weight: bold; transition: 0.3s; border-bottom: 1px solid rgba(212, 175, 55, 0.1); }
        .sidebar a:hover, .sidebar a.active { background: var(--gold); color: var(--velvet); text-shadow: none; }
        
        /* Imperial Content */
        .main-content { margin-left: 260px; padding: 40px; width: 100%; background: url('https://www.transparenttextures.com/patterns/pinstriped-suit.png'); }
        .royal-card { background: var(--parchment); border: 4px double var(--gold); border-radius: 0; padding: 25px; color: #2c3e50; box-shadow: 10px 10px 20px rgba(0,0,0,0.4); position: relative; }
        .stat-box { background: rgba(255,255,255,0.7); border: 1px solid var(--gold); padding: 20px; text-align: center; }
        .gold-btn { background: var(--gold); color: var(--velvet); border: 2px solid #b8860b; font-weight: bold; border-radius: 0; transition: 0.3s; }
        .gold-btn:hover { background: #b8860b; color: white; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-box">
        <img src="logo.png" class="school-logo">
        <h5 class="mt-3">The Lalit Intl.</h5>
    </div>
    <div class="nav-links">
        <a href="index.html" class="active"><i class="fas fa-crown me-2"></i> Dashboard</a>
        <a href="add-student.html"><i class="fas fa-scroll me-2"></i> New Admission</a>
        <a href="view-students.html"><i class="fas fa-users me-2"></i> Student List</a>
        <a href="attendance.html"><i class="fas fa-pen-fancy me-2"></i> Attendance</a>
        <a href="fees.html"><i class="fas fa-coins me-2"></i> Fee Collection</a>
        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Logout</a>
    </div>
</div>

<div class="main-content">
    <div class="royal-card">
        <h2 class="text-center mb-4" style="border-bottom: 2px solid var(--gold); padding-bottom: 10px;">Imperial School Overview</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Total Registered Souls</h6>
                    <h2 id="totalCount">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Presence Today</h6>
                    <h2 id="presentCount">0</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-box">
                    <h6>Treasury (Recent)</h6>
                    <h2 id="feeCount">0</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
        authDomain: "the-lalit-d7472.firebaseapp.com",
        databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com",
        projectId: "the-lalit-d7472",
        storageBucket: "the-lalit-d7472.firebasestorage.app",
        messagingSenderId: "479237084229",
        appId: "1:479237084229:web:f1da384b45c5883b12ff2c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Security Lock (Auth Guard)
    firebase.auth().onAuthStateChanged((user) => {
        if (!user) { window.location.href = "login.html"; }
        else { updateStats(); }
    });

    function updateStats() {
        db.ref('students').on('value', snap => { document.getElementById('totalCount').innerText = snap.numChildren(); });
        const today = new Date().toLocaleDateString('en-GB').replace(/\//g, "-");
        db.ref('attendance/' + today).on('value', snap => {
            let p = 0; snap.forEach(c => { if(c.val().status==='Present') p++; });
            document.getElementById('presentCount').innerText = p;
        });
    }

    function logout() { firebase.auth().signOut().then(() => { window.location.href = "login.html"; }); }
</script>
</body>
</html>
