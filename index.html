<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit International School</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    
    <style>
        .role-section { display: none; width: 100%; }
        #dashboard-view { display: none; }
        #public-view { display: block; }

        /* --- UI Fixes --- */
        .message-card-new {
            background: white; border: 1px solid var(--gold); border-radius: 15px;
            overflow: hidden; margin-bottom: 40px; box-shadow: var(--shadow-md);
            display: flex; flex-direction: column;
        }
        .message-img-full {
            width: 100%; height: auto; max-height: 500px;
            object-fit: contain; background: #fdfaf4; border-bottom: 2px solid var(--gold);
        }
        .message-body { padding: 30px; text-align: center; }
        .message-body h3 { font-family: 'Cinzel', serif; color: var(--royal-blue); margin-bottom: 10px; font-size: 1.5rem; }
        .message-text { line-height: 1.8; color: #333; font-size: 1.1rem; text-align: justify; }

        .gallery-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 25px 0; }
        .gallery-item { 
            width: 100%; height: 300px; object-fit: contain;
            border-radius: 10px; border: 2px solid var(--gold); background: #fdfaf4; 
        }

        .cbse-item-btn {
            display: flex; align-items: center; justify-content: center;
            padding: 15px; background: var(--royal-blue); color: white !important;
            text-decoration: none; border-radius: 8px; font-weight: bold;
            border: 1px solid var(--gold); transition: 0.3s; box-shadow: var(--shadow-sm);
        }
        .cbse-item-btn:hover { background: var(--gold); color: #000 !important; transform: translateY(-3px); }

        .map-wrapper { width: 100%; height: 400px; border-radius: 15px; overflow: hidden; border: 2px solid var(--gold); margin-top: 15px; }
        iframe { width: 100%; height: 100%; border: none; }

        /* Install Banner Styling */
        #install-banner {
            display: none; position: fixed; bottom: 20px; left: 50%; 
            transform: translateX(-50%); background: #001f3f; color: gold; 
            padding: 15px 25px; border: 2px solid gold; border-radius: 50px; 
            z-index: 9999; box-shadow: 0 10px 20px rgba(0,0,0,0.5); 
            font-family: serif; text-align: center; width: 90%; max-width: 400px;
        }
    </style>
</head>
<body>

    <div id="install-banner">
        <p style="margin: 0 0 10px 0; font-weight: bold;">Experience Royal Luxury as an App!</p>
        <button id="install-btn" style="background: gold; color: #001f3f; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer;">Install Now</button>
    </div>
    
    <main class="main-content">
        <div class="royal-card">
            <header class="header" id="brand-header-container"></header>

            <div id="dashboard-view">
                <div class="welcome-banner" style="background: linear-gradient(135deg, var(--royal-blue), #001a4d); color: white; padding: 40px; border-radius: 15px; text-align: center;">
                    <h2 id="welcomeText">Namaste!</h2>
                    <div style="margin-top:20px;">
                        <button onclick="showPublicView()" class="royal-btn" style="background: var(--gold); color: #000;"><i class="fas fa-globe"></i> View Website</button>
                        <button onclick="firebase.auth().signOut()" class="royal-btn" style="background: #c0392b; margin-left: 15px;"><i class="fas fa-sign-out-alt"></i> Logout</button>
                    </div>
                </div>
            </div>

            <div id="public-view">
                <div id="back-to-dash-container" style="display:none; text-align:center; margin-bottom: 20px;">
                    <button onclick="showDashboardView()" class="royal-btn"><i class="fas fa-arrow-left"></i> Back to Dashboard</button>
                </div>

                <div class="mandatory-disclosure">
                    <a id="pdf-link" href="#" target="_blank" style="text-decoration: none; color: #c0392b; font-weight: 800;">
                        <i class="fas fa-file-shield"></i> MANDATORY PUBLIC DISCLOSURE (APPENDIX-IX)
                    </a>
                </div>

                <div class="form-section">
                    <marquee id="news-marquee" style="font-weight: bold; color: var(--royal-blue);">Loading Updates...</marquee>
                </div>

                <section>
                    <h2 class="brand-font" style="text-align: center;">About Our Institution</h2>
                    <p id="about-content" style="text-align: center; margin-bottom: 30px; line-height: 1.6;">
                        Welcome to our temple of learning. Our institution is dedicated to nurturing young minds with a blend of modern education and traditional values.
                    </p>
                    <div class="cbse-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px;">
                        <a href="academics.html" class="cbse-item-btn">Academics</a>
                        <a href="management.html" class="cbse-item-btn">Management</a>
                        <a href="infrastructure.html" class="cbse-item-btn">Infrastructure</a>
                        <a href="admissions.html" class="cbse-item-btn">Admissions</a>
                    </div>
                </section>

                <div style="margin-top: 50px;">
                    <div class="message-card-new">
                        <img id="director-img" src="logo.png" class="message-img-full">
                        <div class="message-body">
                            <h3>Director's Message</h3>
                            <p id="director-msg" class="message-text">Loading...</p>
                        </div>
                    </div>

                    <div class="message-card-new">
                        <img id="principal-img" src="logo.png" class="message-img-full">
                        <div class="message-body">
                            <h3>Principal's Message</h3>
                            <p id="principal-msg" class="message-text">Loading...</p>
                        </div>
                    </div>
                </div>

                <section style="margin-top: 50px;">
                    <h2 class="brand-font" style="text-align: center;">Event Gallery</h2>
                    <div id="gallery-grid" class="gallery-container"></div>
                </section>

                <section style="margin-top: 50px;" class="form-section">
                    <h2 class="brand-font">Contact & Location</h2>
                    <div class="input-grid">
                        <div style="padding: 10px;">
                            <p><strong><i class="fas fa-phone"></i> Phone:</strong> <br><span id="display-phone">...</span></p>
                            <p><strong><i class="fas fa-map-marker-alt"></i> Address:</strong> <br> <span id="display-address">...</span></p>
                        </div>
                        <div class="map-wrapper">
                            <iframe id="map-frame" src="" allowfullscreen="" loading="lazy"></iframe>
                        </div>
                    </div>
                </section>
            </div>

            <footer style="text-align: center; padding: 40px; border-top: 1px solid var(--gold); margin-top: 40px; font-size: 14px;">
                <p>Â© 2026 <span id="brand-name"></span>. All Rights Reserved.</p>
            </footer>
        </div>
    </main>

    <script src="brand.js"></script>
    <script src="firebase-config.js"></script>
    <script src="menu.js"></script>

    <script>
        // --- 1. PWA INSTALL LOGIC ---
        let deferredPrompt;
        const installBanner = document.getElementById('install-banner');
        const installBtn = document.getElementById('install-btn');

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(reg => {
                    console.log('SW Registered');
                }).catch(err => console.log('SW Error', err));
            });
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') installBanner.style.display = 'none';
                deferredPrompt = null;
            }
        });

        window.addEventListener('appinstalled', () => {
            installBanner.style.display = 'none';
        });

        // --- 2. WEBSITE LOGIC & FIREBASE ---
        function showPublicView() {
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('public-view').style.display = 'block';
            document.getElementById('back-to-dash-container').style.display = (firebase.auth().currentUser) ? 'block' : 'none';
            fetchWebsiteData();
        }

        function showDashboardView() {
            document.getElementById('dashboard-view').style.display = 'block';
            document.getElementById('public-view').style.display = 'none';
        }

        async function fetchWebsiteData() {
            const db = firebase.firestore();
            
            db.collection('content').doc('newsData').get().then(doc => { if(doc.exists) document.getElementById('news-marquee').innerText = doc.data().text; });
            db.collection('content').doc('cbse').get().then(doc => { if(doc.exists) document.getElementById('pdf-link').href = doc.data().disclosureUrl; });
            db.collection('content').doc('aboutUs').get().then(doc => { if(doc.exists) document.getElementById('about-content').innerText = doc.data().text; });

            db.collection('messages').doc('director').get().then(doc => {
                if(doc.exists) {
                    document.getElementById('director-msg').innerText = doc.data().text;
                    document.getElementById('director-img').src = doc.data().imageUrl || 'logo.png';
                }
            });

            db.collection('messages').doc('principal').get().then(doc => {
                if(doc.exists) {
                    document.getElementById('principal-msg').innerText = doc.data().text;
                    document.getElementById('principal-img').src = doc.data().imageUrl || 'logo.png';
                }
            });

            db.collection('content').doc('gallery').get().then(doc => {
                const grid = document.getElementById('gallery-grid');
                grid.innerHTML = '';
                if(doc.exists && doc.data().images) {
                    doc.data().images.forEach(url => {
                        if(url) grid.innerHTML += `<img src="${url}" class="gallery-item" onerror="this.src='logo.png'">`;
                    });
                }
            });

            db.collection('content').doc('contactInfo').get().then(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    document.getElementById('display-phone').innerText = data.phone || '...';
                    document.getElementById('display-address').innerText = data.address || '...';
                    document.getElementById('map-frame').src = data.mapUrl || '';
                }
            });
        }

        firebase.auth().onAuthStateChanged(user => {
            if(user) { showDashboardView(); } 
            else { showPublicView(); }
        });
    </script>
</body>
</html>

