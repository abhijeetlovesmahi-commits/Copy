<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit Intl. School - Imperial Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --royal-blue: #002366;
            --gold: #D4AF37;
            --deep-gold: #aa8a2e;
            --light-gold: #FDFBF0;
        }

        body {
            background-color: var(--light-gold);
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 250px;
            height: 100vh;
            background: var(--royal-blue);
            position: fixed;
            color: white;
            padding: 20px;
            border-right: 4px solid var(--gold);
        }

        .nav-links a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            display: block;
            padding: 12px;
            margin-bottom: 5px;
            border-radius: 8px;
            transition: 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            background: var(--gold);
            color: var(--royal-blue);
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 30px;
        }

        .royal-header {
            border-bottom: 2px solid var(--gold);
            margin-bottom: 30px;
            padding-bottom: 10px;
            color: var(--royal-blue);
            font-family: 'Cinzel', serif;
        }

        /* Stats Cards */
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: 0.3s;
        }

        .stat-card:hover { transform: translateY(-5px); }
        .icon-box {
            width: 50px; height: 50px;
            background: var(--light-gold);
            color: var(--deep-gold);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        /* Table & Chart Container */
        .data-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            height: 100%;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="text-center mb-4">
        <h4 style="font-family: 'Cinzel', serif; color: var(--gold);">THE LALIT</h4>
        <small>Imperial Management</small>
    </div>
    <div class="nav-links">
        <a href="index.html" class="active"><i class="fas fa-th-large me-2"></i> Dashboard</a>
        <a href="admission.html"><i class="fas fa-user-plus me-2"></i> Admission</a>
        <a href="fee-master.html"><i class="fas fa-cogs me-2"></i> Fee Master</a>
        <a href="collect-fees.html"><i class="fas fa-wallet me-2"></i> Collect Fees</a>
        <a href="defaulter-list.html"><i class="fas fa-exclamation-triangle me-2"></i> Defaulters</a>
        <a href="#" onclick="logout()"><i class="fas fa-power-off me-2"></i> Logout</a>
    </div>
</div>

<div class="main-content">
    <div class="royal-header d-flex justify-content-between align-items-center">
        <h2>Imperial Overview</h2>
        <div id="currentDate" class="text-muted small"></div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted mb-1">Total Souls</p>
                        <h3 id="totalStudents">0</h3>
                    </div>
                    <div class="icon-box"><i class="fas fa-user-graduate"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted mb-1">Treasury (Today)</p>
                        <h3 id="todayCollection">₹0</h3>
                    </div>
                    <div class="icon-box"><i class="fas fa-coins"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted mb-1">Defaulters</p>
                        <h3 id="defaulterCount" class="text-danger">0</h3>
                    </div>
                    <div class="icon-box"><i class="fas fa-user-clock"></i></div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="d-flex justify-content-between">
                    <div>
                        <p class="text-muted mb-1">Active Staff</p>
                        <h3>12</h3>
                    </div>
                    <div class="icon-box"><i class="fas fa-chalkboard-teacher"></i></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-7">
            <div class="data-container">
                <h5 class="mb-4">Fee Collection Trends (Monthly)</h5>
                <canvas id="revenueChart" height="250"></canvas>
            </div>
        </div>
        <div class="col-md-5">
            <div class="data-container">
                <h5 class="mb-4">Recent Treasury Entries</h5>
                <div id="recentFees" style="font-size: 0.9rem;">
                    <p class="text-center text-muted">Fetching records...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Firebase Config (New Firestore Version)
    const firebaseConfig = {
        apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
        authDomain: "the-lalit-d7472.firebaseapp.com",
        projectId: "the-lalit-d7472",
        appId: "1:479237084229:web:31078825739b3c5712ff2c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    document.getElementById('currentDate').innerText = new Date().toDateString();

    // 1. Fetch Real Stats
    async function loadStats() {
        // Total Students
        db.collection('students').onSnapshot(snap => {
            document.getElementById('totalStudents').innerText = snap.size;
        });

        // Today's Collection
        const today = new Date().toLocaleDateString();
        db.collection('fee_transactions').where('date', '==', today).onSnapshot(snap => {
            let total = 0;
            snap.forEach(doc => total += Number(doc.data().amount));
            document.getElementById('todayCollection').innerText = "₹" + total;
        });

        // Recent Transactions List
        db.collection('fee_transactions').orderBy('timestamp', 'desc').limit(5).onSnapshot(snap => {
            const container = document.getElementById('recentFees');
            container.innerHTML = "";
            snap.forEach(doc => {
                const data = doc.data();
                container.innerHTML += `
                    <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                        <span>ID: ${data.studentID}</span>
                        <span class="fw-bold text-success">+₹${data.amount}</span>
                    </div>
                `;
            });
        });
    }

    // 2. Revenue Chart (Example Logic)
    const ctx = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Collection (₹)',
                data: [12000, 19000, 15000, 25000, 22000, 30000],
                borderColor: '#D4AF37',
                backgroundColor: 'rgba(212, 175, 55, 0.1)',
                fill: true,
                tension: 0.4
            }]
        }
    });

    loadStats();
    function logout() { firebase.auth().signOut().then(() => { window.location.href = "login.html"; }); }
</script>
</body>
</html>
