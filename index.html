<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit International School | Welcome</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    
    <script src="brand.js"></script>
    <script src="firebase-config.js"></script>

    <style>
        /* Modern Gallery Grid for 12 Photos */
        .gallery-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px; 
            margin: 30px 0; 
        }
        .gallery-item { 
            width: 100%; 
            height: 250px; 
            object-fit: cover; 
            border-radius: 12px; 
            border: 3px solid var(--gold); 
            transition: transform 0.3s;
            background: #f0f0f0;
        }
        .gallery-item:hover { transform: scale(1.03); }

        .message-img-full {
            width: 100%; height: auto; max-height: 550px;
            object-fit: contain; background: #fff;
            border-bottom: 3px solid var(--gold);
        }
        .map-wrapper { width: 100%; height: 450px; border-radius: 15px; overflow: hidden; border: 3px solid var(--gold); margin-top: 20px; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <main class="main-content">
        <div class="royal-card">
            
            <header class="header" id="brand-header-container"></header>

            <div class="form-section">
                <marquee id="news-marquee" style="font-weight: bold; color: var(--royal-blue); font-size: 1.2rem;">Loading School Updates...</marquee>
            </div>

            <div id="public-view">
                <section>
                    <h2 class="brand-font" style="text-align: center;">Director & Principal Messages</h2>
                    <div style="margin-top: 30px;">
                        <div class="message-card-new">
                            <img id="director-img" src="" class="message-img-full" onerror="this.src='https://via.placeholder.com/800x500?text=Director+Photo'">
                            <div class="message-body">
                                <h3>Director's Message</h3>
                                <p id="director-msg" class="message-text">Loading...</p>
                            </div>
                        </div>
                        <div class="message-card-new">
                            <img id="principal-img" src="" class="message-img-full" onerror="this.src='https://via.placeholder.com/800x500?text=Principal+Photo'">
                            <div class="message-body">
                                <h3>Principal's Message</h3>
                                <p id="principal-msg" class="message-text">Loading...</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section style="margin-top: 60px;">
                    <h2 class="brand-font" style="text-align: center;">Event Gallery</h2>
                    <div id="gallery-grid" class="gallery-container">
                        </div>
                </section>

                <section style="margin-top: 60px;" class="form-section">
                    <h2 class="brand-font">Contact & Location</h2>
                    <div class="input-grid">
                        <div style="padding: 20px;">
                            <p><strong><i class="fas fa-phone"></i> Phone:</strong> <br><span id="display-phone" style="font-size: 1.2rem;">...</span></p>
                            <p><strong><i class="fas fa-map-marker-alt"></i> Address:</strong> <br> <span id="display-address">...</span></p>
                        </div>
                        <div class="map-wrapper">
                            <iframe id="map-frame" src="" allowfullscreen="" loading="lazy"></iframe>
                        </div>
                    </div>
                </section>
            </div>

            <footer style="text-align: center; padding: 40px; border-top: 2px solid var(--gold); margin-top: 50px;">
                <p>Â© 2026 <span id="brand-name-footer"></span>. All Rights Reserved.</p>
            </footer>
        </div>
    </main>

    <script>
        const db = firebase.firestore();

        async function fetchWebsiteData() {
            // 1. News Ticker
            db.collection('content').doc('newsData').get().then(doc => { 
                if(doc.exists) document.getElementById('news-marquee').innerText = doc.data().text; 
            });

            // 2. Messages (Director/Principal)
            db.collection('messages').doc('director').get().then(doc => {
                if(doc.exists) {
                    document.getElementById('director-msg').innerText = doc.data().text;
                    document.getElementById('director-img').src = doc.data().imageUrl;
                }
            });
            db.collection('messages').doc('principal').get().then(doc => {
                if(doc.exists) {
                    document.getElementById('principal-msg').innerText = doc.data().text;
                    document.getElementById('principal-img').src = doc.data().imageUrl;
                }
            });

            // 3. 12 Photo Gallery Logic
            db.collection('content').doc('gallery').get().then(doc => {
                const grid = document.getElementById('gallery-grid');
                grid.innerHTML = ''; // Clear old content
                if(doc.exists && doc.data().images) {
                    doc.data().images.forEach(url => {
                        if(url && url.length > 5) {
                            grid.innerHTML += `<img src="${url}" class="gallery-item" loading="lazy">`;
                        }
                    });
                }
            });

            // 4. Contact Info & Map Fix
            db.collection('content').doc('contactInfo').get().then(doc => {
                if(doc.exists) {
                    const data = doc.data();
                    document.getElementById('display-phone').innerText = data.phone || 'Contact school office';
                    document.getElementById('display-address').innerText = data.address || 'Address not updated';
                    if(data.mapUrl) {
                        document.getElementById('map-frame').src = data.mapUrl;
                    }
                }
            });
        }

        // Run on load
        window.onload = fetchWebsiteData;
    </script>
</body>
</html>
