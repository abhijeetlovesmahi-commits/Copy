<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile - TLIS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-header-card { background: #300a24; color: white; border-radius: 15px; padding: 30px; margin-top: 20px; text-align: center; }
        .profile-pic-large { width: 140px; height: 140px; border-radius: 50%; border: 4px solid #ff9800; object-fit: cover; background: white; }
        .info-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-top: 20px; }
        .edit-input { display: none; margin-bottom: 10px; }
        .value-display { font-weight: bold; color: #300a24; margin-bottom: 15px; display: block; }
    </style>
</head>
<body>

<div class="main-content p-4">
    <button onclick="window.location.href='add-student.html'" class="btn btn-sm btn-outline-dark mb-3"><i class="fas fa-arrow-left"></i> Back</button>
    
    <div id="loader" class="text-center mt-5"><div class="spinner-border text-warning"></div></div>

    <div id="profileContent" style="display:none;">
        <div class="profile-header-card">
            <img id="pPhoto" src="" class="profile-pic-large mb-2">
            <h3 id="pNameDisplay">Name</h3>
            <input type="text" id="edit_name" class="form-control edit-input text-center w-50 mx-auto">
            <p id="pIdDisplay" class="badge bg-warning text-dark">ID: --</p>
        </div>

        <div class="d-flex justify-content-center gap-2 mt-3">
            <button id="btnEdit" onclick="toggleEdit(true)" class="btn btn-primary"><i class="fas fa-edit"></i> Edit</button>
            <button id="btnSave" onclick="saveChanges()" class="btn btn-success edit-input"><i class="fas fa-save"></i> Save</button>
            <button id="btnCancel" onclick="toggleEdit(false)" class="btn btn-secondary edit-input">Cancel</button>
            <button onclick="deleteStudent()" class="btn btn-danger"><i class="fas fa-trash"></i> Delete</button>
        </div>

        <div class="info-card">
            <div class="row">
                <div class="col-md-6">
                    <label class="text-muted small">Father's Name</label>
                    <span id="pFatherDisplay" class="value-display">--</span>
                    <input type="text" id="edit_father" class="form-control edit-input">

                    <label class="text-muted small">Mobile</label>
                    <span id="pMobileDisplay" class="value-display">--</span>
                    <input type="tel" id="edit_mobile" class="form-control edit-input">
                </div>
                <div class="col-md-6">
                    <label class="text-muted small">Class</label>
                    <span id="pClassDisplay" class="value-display">--</span>
                    <input type="text" id="edit_class" class="form-control edit-input">

                    <label class="text-muted small">DOB</label>
                    <span id="pDobDisplay" class="value-display">--</span>
                    <input type="date" id="edit_dob" class="form-control edit-input">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs", authDomain: "the-lalit-d7472.firebaseapp.com", databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com", projectId: "the-lalit-d7472", storageBucket: "the-lalit-d7472.firebasestorage.app", messagingSenderId: "479237084229", appId: "1:479237084229:web:f1da384b45c5883b12ff2c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const studentId = new URLSearchParams(window.location.search).get('id');

    function loadData() {
        db.ref('students/' + studentId).on('value', snap => {
            if(!snap.exists()) return;
            const s = snap.val();
            document.getElementById('pPhoto').src = s.photo || 'https://via.placeholder.com/150';
            document.getElementById('pNameDisplay').innerText = s.name;
            document.getElementById('pIdDisplay').innerText = "ID: " + s.uniqueId;
            document.getElementById('pFatherDisplay').innerText = s.father;
            document.getElementById('pMobileDisplay').innerText = s.mobile;
            document.getElementById('pClassDisplay').innerText = s.class;
            document.getElementById('pDobDisplay').innerText = s.dob;

            document.getElementById('edit_name').value = s.name;
            document.getElementById('edit_father').value = s.father;
            document.getElementById('edit_mobile').value = s.mobile;
            document.getElementById('edit_class').value = s.class;
            document.getElementById('edit_dob').value = s.dob;

            document.getElementById('loader').style.display = 'none';
            document.getElementById('profileContent').style.display = 'block';
        });
    }

    function toggleEdit(edit) {
        document.querySelectorAll('.value-display, #btnEdit, #pNameDisplay').forEach(el => el.style.display = edit ? 'none' : 'block');
        document.querySelectorAll('.edit-input').forEach(el => el.style.display = edit ? 'block' : 'none');
    }

    function saveChanges() {
        const upData = {
            name: document.getElementById('edit_name').value,
            father: document.getElementById('edit_father').value,
            mobile: document.getElementById('edit_mobile').value,
            class: document.getElementById('edit_class').value,
            dob: document.getElementById('edit_dob').value
        };
        db.ref('students/' + studentId).update(upData).then(() => { alert("Updated!"); toggleEdit(false); });
    }

    function deleteStudent() {
        if(confirm("Hamesha ke liye delete karein?")) {
            db.ref('students/' + studentId).remove().then(() => { window.location.href='add-student.html'; });
        }
    }

    if(studentId) loadData(); else alert("No ID found");
</script>
</body>
</html>
