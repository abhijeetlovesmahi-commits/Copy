<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile - TLIS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css"> 
    
    <style>
        .profile-header-card { background: linear-gradient(135deg, #300a24 0%, #5e1b3d 100%); color: white; border-radius: 15px; padding: 30px; margin-top: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); position: relative; }
        .profile-pic-large { width: 150px; height: 150px; border-radius: 50%; border: 5px solid #ff9800; object-fit: cover; background: #fff; }
        .info-card { background: #fff; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); padding: 20px; height: 100%; border-left: 5px solid #ff9800; }
        .label-text { color: #888; font-size: 0.85em; text-transform: uppercase; }
        .value-text { font-size: 1.1em; font-weight: 600; color: #300a24; margin-bottom: 15px; }
        .edit-input { display: none; margin-bottom: 10px; } /* Initially hidden */
        .royal-badge { background: #ff9800; color: #300a24; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-box"><h5 class="mt-2 text-white">TLIS Imperial</h5></div>
    <a href="index.html"><i class="fas fa-crown me-2"></i> Dashboard</a>
    <a href="add-student.html"><i class="fas fa-arrow-left me-2"></i> Back</a>
</div>

<div class="main-content">
    <div class="container pb-5">
        
        <div id="loader" class="text-center mt-5"><div class="spinner-border text-warning"></div></div>

        <div id="profileContent" style="display: none;">
            <div class="profile-header-card text-center">
                <img id="pPhoto" src="" class="profile-pic-large mb-3">
                <h2 id="pNameDisplay">Student Name</h2>
                <input type="text" id="edit_name" class="form-control edit-input text-center w-50 mx-auto">
                <div class="d-flex justify-content-center gap-2">
                    <span class="royal-badge" id="pId">ID</span>
                    <span class="royal-badge bg-white" id="pClassDisplay">Class</span>
                    <select id="edit_class" class="form-select edit-input w-25"><option value="1">1</option><option value="10">10</option></select>
                </div>
            </div>

            <div class="d-flex justify-content-end gap-2 mt-3">
                <button id="btnEdit" onclick="toggleEdit(true)" class="btn btn-sm btn-outline-primary"><i class="fas fa-edit"></i> Edit</button>
                <button id="btnSave" onclick="saveChanges()" class="btn btn-sm btn-success edit-input"><i class="fas fa-save"></i> Save</button>
                <button id="btnCancel" onclick="toggleEdit(false)" class="btn btn-sm btn-secondary edit-input">Cancel</button>
                <button onclick="deleteStudent()" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i> Delete</button>
            </div>

            <div class="row mt-4 g-4">
                <div class="col-md-6">
                    <div class="info-card">
                        <div class="label-text">Father's Name</div>
                        <div class="value-text" id="pFatherDisplay">--</div>
                        <input type="text" id="edit_father" class="form-control edit-input">

                        <div class="label-text">Mobile</div>
                        <div class="value-text" id="pMobileDisplay">--</div>
                        <input type="tel" id="edit_mobile" class="form-control edit-input">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-card" style="border-left-color: #300a24;">
                        <div class="label-text">DOB</div>
                        <div class="value-text" id="pDobDisplay">--</div>
                        <input type="date" id="edit_dob" class="form-control edit-input">

                        <div class="label-text">Aadhaar</div>
                        <div class="value-text" id="pAadhaarDisplay">--</div>
                        <input type="number" id="edit_aadhaar" class="form-control edit-input">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs", authDomain: "the-lalit-d7472.firebaseapp.com", databaseURL: "https://the-lalit-d7472-default-rtdb.firebaseio.com", projectId: "the-lalit-d7472", storageBucket: "the-lalit-d7472.firebasestorage.app", messagingSenderId: "479237084229", appId: "1:479237084229:web:f1da384b45c5883b12ff2c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const urlParams = new URLSearchParams(window.location.search);
    const studentId = urlParams.get('id');

    function loadProfile() {
        db.ref('students/' + studentId).once('value', (snap) => {
            if(!snap.exists()) return alert("Not found");
            const s = snap.val();
            
            // Set Displays
            document.getElementById('pPhoto').src = s.photo || 'https://via.placeholder.com/150';
            document.getElementById('pNameDisplay').innerText = s.name;
            document.getElementById('pId').innerText = s.uniqueId;
            document.getElementById('pClassDisplay').innerText = "Class " + s.class;
            document.getElementById('pFatherDisplay').innerText = s.father;
            document.getElementById('pMobileDisplay').innerText = s.mobile;
            document.getElementById('pDobDisplay').innerText = s.dob;
            document.getElementById('pAadhaarDisplay').innerText = s.aadhaar || "N/A";

            // Set Inputs (for editing)
            document.getElementById('edit_name').value = s.name;
            document.getElementById('edit_class').value = s.class;
            document.getElementById('edit_father').value = s.father;
            document.getElementById('edit_mobile').value = s.mobile;
            document.getElementById('edit_dob').value = s.dob;
            document.getElementById('edit_aadhaar').value = s.aadhaar || "";

            document.getElementById('loader').style.display = 'none';
            document.getElementById('profileContent').style.display = 'block';
        });
    }

    function toggleEdit(isEditing) {
        const displays = document.querySelectorAll('.value-text, #pNameDisplay, #pClassDisplay, #btnEdit');
        const inputs = document.querySelectorAll('.edit-input');
        
        displays.forEach(el => el.style.display = isEditing ? 'none' : 'block');
        inputs.forEach(el => el.style.display = isEditing ? 'block' : 'none');
    }

    function saveChanges() {
        const updatedData = {
            name: document.getElementById('edit_name').value,
            class: document.getElementById('edit_class').value,
            father: document.getElementById('edit_father').value,
            mobile: document.getElementById('edit_mobile').value,
            dob: document.getElementById('edit_dob').value,
            aadhaar: document.getElementById('edit_aadhaar').value
        };

        db.ref('students/' + studentId).update(updatedData).then(() => {
            alert("Updated Successfully!");
            location.reload();
        });
    }

    function deleteStudent() {
        if(confirm("Are you sure? Ye bachha permanent delete ho jayega!")) {
            db.ref('students/' + studentId).remove().then(() => {
                alert("Deleted!");
                window.location.href = 'add-student.html';
            });
        }
    }

    if(studentId) loadProfile();
</script>
</body>
</html>
